---
title: 表达式基础
tags:
  - null
categories:
  - C++
cover: false
abbrlink: 764aaa73
date: 2022-03-15 22:18:43
---

**表达式**通常由**运算符**和**运算对象**组成

**字面值**和**变量**是最简单的表达式

# 基本概念
一元运算符：作用于一个运算对象的运算符，如取地址符`&`和解引用符`*`

二元运算符：作用于两个运算对象的运算符，如相等运算符`==`和乘法运算符`*`

三元运算符：作用于三个运算对象，如条件运算符`_ ? _ : _`

## 组合运算符和运算对象
表达式的求值结果，依赖于运算符的**优先级**、**结合律**以及**运算对象的求值顺序**
> 优先级：例如，`*`优先级高于`+`
> 结合律：通常是从左往右，遇到括号时则是由内到外
> 求值顺序：例如，`f1() + f2()`，对于`f1()`和`f2()`的计算，没有明确的顺序


## 重载运算符
当运算符作用于类类型的运算对象时，用户可以自行定义其含义
> 这种自定义的过程事实上是为已存在的运算符赋予了另外一层含义，所以称之为重载运算符

`IO`库的`>>`和`<<`运算符以及`string`对象、`vector`对象和迭代器使用的运算符都是重载的运算符

使用重载运算符时，其包括运算对象的类型和返回值的类型，都是由该运算符定义的

**运算对象的个数、运算符的优先级和结合律都是无法改变的**


## 左值和右值
C++的表达式要么是右值，要么就是左值，即，非左即右
> C语言：左值可以位于赋值语句的左侧，右值则不能

C++语言则复杂得多：
1. 右值：取不到地址的表达式
2. 左值：能取到地址的表达式
3. 常量对象为代表的左值不能作为赋值语句的左侧运算对象。（即，不能修改常量对象的值）
4. 某些表达式的求值结果是对象，但它们是右值。（例如，临时的对象`1+a`无法取地址，故而是右值）

**当一个对象被用作右值的时候，用的是对象的值（内容）**

**当对象被用作左值的时候，用的是对象的身份（在内存中的位置）**

> 在需要右值的地方可以用左值来代替。当一个左值被当成右值使用时，实际使用的是它的内容（值）
> 
> 不能把右值当成左值（也就是位置）使用


**取地址符作用于一个左值运算对象，返回一个指向该运算对象的指针，这个指针是一个右值**

**内置解引用运算符、下标运算符、迭代器解引用运算符、`string`和`vector`的下标运算符的求值结果都是左值**

内置类型和迭代器的递增递减运算符作用于左值运算对象，其前置版本（之前章节所用的形式）所得的结果也是左值

关键字`decltype`与表达式：**如果表达式的求值结果是左值，`decltype`作用于该表达式（不是变量）得到一个引用类型**。例如，对于`int *p`，因为解引用运算符（即，`*p`）生成左值，所以`decltype(*p)`的结果是引用类型，即`int&`；另一方面，因为取地址运算符（即，`&p`）生成右值，所以`decltype(&p)`的结果是`int**`
